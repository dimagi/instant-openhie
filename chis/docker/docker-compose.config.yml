version: "2.4"

services:
  cchq-config:
    image: kaapstorm/commcarehq_incl:latest
    privileged: true  # allows mount inside container
    depends_on:
      cchq-postgres:
        condition: service_started
      cchq-couch:
        condition: service_healthy
      cchq-redis:
        condition: service_healthy
      cchq-elasticsearch2:
        condition: service_healthy
      cchq-kafka:
        condition: service_healthy
      cchq-zookeeper:
        condition: service_started
      cchq-minio:
        condition: service_healthy
    volumes:
      - cchq-shared_files:/sharedfiles
    command: 'docker/init-hq.sh'

  cchq-formplayer:
    extends:
      file: docker-compose.common.yml
      service: cchq-formplayer
    depends_on:
      cchq-postgres:
        condition: service_started
      cchq-redis:
        condition: service_healthy

  cchq-postgres:
    extends:
      file: docker-compose.common.yml
      service: cchq-postgres

  cchq-couch:
    extends:
      file: docker-compose.common.yml
      service: cchq-couch

  cchq-redis:
    extends:
      file: docker-compose.common.yml
      service: cchq-redis

  cchq-elasticsearch2:
    extends:
      file: docker-compose.common.yml
      service: cchq-elasticsearch2

  cchq-kafka:
    extends:
      file: docker-compose.common.yml
      service: cchq-kafka

  cchq-zookeeper:
    extends:
      file: docker-compose.common.yml
      service: cchq-zookeeper

  cchq-minio:
    extends:
      file: docker-compose.common.yml
      service: cchq-minio

volumes:
  cchq-shared_files:
  cchq-postgres-vol:
  cchq-couch-vol:
  cchq-redis-vol:
  cchq-elasticsearch2-vol:
  cchq-kafka-vol:
  cchq-zookeeper-vol:
  cchq-minio-conf:
  cchq-minio-data:
